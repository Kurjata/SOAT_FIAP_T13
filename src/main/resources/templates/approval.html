<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Aprovação da Ordem de Serviço</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Boxicons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex align-items-center justify-content-center min-vh-100">

<div class="card shadow-lg w-100" style="max-width: 900px;">
    <div class="card-body p-5">
        <h2 class="text-center mb-4"><i class='bx bx-wrench'></i> Aprovação da ordem de serviço</h2>
        <p class="text-center text-muted mb-5">Confira os detalhes abaixo e escolha uma opção:</p>

        <!-- Detalhes principais -->
        <div class="mb-4">
            <div class="row mb-2">
                <div class="col-md-6"><strong>Cliente:</strong> <span th:text="${order.user.name}"></span></div>
                <div class="col-md-6"><strong>E-mail:</strong> <span th:text="${order.user.email}"></span></div>
            </div>
            <div class="row mb-2">
                <div class="col-md-6"><strong>Veículo:</strong> <span th:text="${order.vehicle.plate}"></span></div>
                <div class="col-md-6">
                    <strong>Status:</strong>
                    <span class="badge bg-info text-dark" th:text="${order.orderStatusEnum}"></span>
                </div>
            </div>
        </div>

        <!-- Serviços + insumos unificados -->
        <h4 class="mt-4 mb-3"><i class='bx bx-task'></i> Serviços e Insumos</h4>
        <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle">
                <thead class="table-light">
                <tr>
                    <th>Descrição</th>
                    <th>Quantidade</th>
                    <th class="text-end">Preço Unitário</th>
                    <th class="text-end">Subtotal</th>
                </tr>
                </thead>
                <tbody>
                <th:block th:each="item : ${order.orderActivities}">
                    <!-- Linha do serviço -->
                    <tr class="table-primary">
                        <td th:text="${item.serviceLabor.description}"></td>
                        <td></td>
                        <td class="text-end" th:text="${#numbers.formatDecimal(item.serviceLabor.laborCost, 2, 'POINT', 2, 'POINT')}"></td>
                        <td class="text-end" th:text="${#numbers.formatDecimal(item.serviceLabor.laborCost, 2, 'POINT', 2, 'POINT')}"></td>
                    </tr>

                    <!-- Linhas dos insumos do serviço -->
                    <tr th:each="supply : ${item.activityItems}">
                        <td style="padding-left: 30px;"><i class='bx bx-cube'></i> <span th:text="${supply.partStock.name}"></span></td>
                        <td th:text="${supply.quantity}"></td>
                        <td class="text-end" th:text="${#numbers.formatDecimal(supply.unitPrice, 2, 'POINT', 2, 'POINT')}"></td>
                        <td class="text-end" th:text="${#numbers.formatDecimal(supply.unitPrice * supply.quantity, 2, 'POINT', 2, 'POINT')}"></td>
                    </tr>
                </th:block>
                </tbody>
            </table>
        </div>

        <!-- Total geral -->
        <div class="d-flex justify-content-end mt-4">
            <h5 class="fw-bold"><i class='bx bx-dollar-circle'></i> Total da ordem:
                <span class="text-success" th:text="${#numbers.formatDecimal(grandTotal, 2, 'POINT', 2, 'POINT')}">R$ 0,00</span>
            </h5>
        </div>

        <!-- Botões de decisão -->
        <div class="d-flex justify-content-center gap-4 mt-5">
            <form th:action="@{/client/service-orders/decision}" method="post">
                <input type="hidden" name="token" th:value="${token}"/>
                <input type="hidden" name="status" value="APROVADO_CLIENTE"/>
                <button type="submit" class="btn btn-success btn-lg px-5"><i class='bx bx-check-circle'></i> Aprovar</button>
            </form>

            <form th:action="@{/client/service-orders/decision}" method="post">
                <input type="hidden" name="token" th:value="${token}"/>
                <input type="hidden" name="status" value="REPROVADO_CLIENTE"/>
                <button type="submit" class="btn btn-danger btn-lg px-5"><i class='bx bx-x-circle'></i> Reprovar</button>
            </form>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
</body>
</html>
